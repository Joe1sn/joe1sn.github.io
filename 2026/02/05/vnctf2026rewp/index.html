<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Joe1sn's Cabin | 【CTF】2026 VNCTF Re 复现与WriteUp</title><meta name="description" content="&lt;p&gt;好久没打CTF了，得快三年了吧。有一道安卓逆向就不写了，12月重装系统后没有环境&lt;/p&gt;"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="https://joe1sn.eu.org/atom.xml" title="Joe1sn's Cabin"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Joe1sn's Cabin" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/">Joe1sn's Cabin</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="https://github.com/Joe1sn" target="_blank">GITHUB</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h3 class="article__title">【CTF】2026 VNCTF Re 复现与WriteUp</h3><div class="article__date metadata"><div class="post-info">2026/02/05</div></div><div class="article__tags metadata">Tags:
<a class="article__tags__link metadata" href="/tags/CTF/">CTF</a><a class="article__tags__link metadata" href="/tags/writeup/">writeup</a></div><div class="article__body"><p>好久没打CTF了，得快三年了吧。有一道安卓逆向就不写了，12月重装系统后没有环境</p>
<span id="more"></span>
<h1 id="1-ez_maze"><a class="markdownIt-Anchor" href="#1-ez_maze"></a> 1. ez_maze</h1>
<blockquote>
<p>最短路径即为flag</p>
</blockquote>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202084931310.png" alt="image-20260202084931310" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202084426729.png" alt="image-20260202084426729" /></p>
<p>MFC程序，常规IDA</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202084520522.png" alt="image-20260202084520522" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202084529626.png" alt="image-20260202084529626" /></p>
<p>一眼壳，上动态调试，还好是签到题，假设没有反调试</p>
<h3 id="快速定位"><a class="markdownIt-Anchor" href="#快速定位"></a> 快速定位</h3>
<p>直接运行到程序开始，定位字符串</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202085011968.png" alt="image-20260202085011968" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202085052446.png" alt="image-20260202085052446" /></p>
<p>下个断点，然后dump</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202085217460.png" alt="image-20260202085217460" /></p>
<p>然后IDA</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202085626673.png" alt="image-20260202085626673" /></p>
<p>发现验证算法的方向是反着来的。可以翻过去看看迷宫生成算法，其实在附件没更新之前的版本更好观察一点，但是直接在内存里面看更快些。</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202090209093.png" alt="image-20260202090209093" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202090154092.png" alt="image-20260202090154092" /></p>
<p>部分操作迷宫可能直接走死，没有到这个判断，跟一下<code>rcx</code>就行了的值，然后看<code>rcx+0x260</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202090546440.png" alt="image-20260202090546440" /></p>
<h3 id="还原迷宫"><a class="markdownIt-Anchor" href="#还原迷宫"></a> 还原迷宫</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">test = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">        ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(test)+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">20</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(test[i-<span class="number">1</span>],)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(test[i-<span class="number">1</span>], end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202090824687.png" alt="image-20260202090824687" /></p>
<h3 id="解出flag"><a class="markdownIt-Anchor" href="#解出flag"></a> 解出flag</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">maze = [[<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shortest_path_wasd</span>(<span class="params">maze, start, end</span>):</span><br><span class="line">    rows, cols = <span class="built_in">len</span>(maze), <span class="built_in">len</span>(maze[<span class="number">0</span>])</span><br><span class="line">    visited = [[<span class="literal">False</span>] * cols <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rows)]</span><br><span class="line">    parent = [[<span class="literal">None</span>] * cols <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rows)]</span><br><span class="line"></span><br><span class="line">    queue = deque()</span><br><span class="line">    queue.append(start)</span><br><span class="line">    visited[start[<span class="number">0</span>]][start[<span class="number">1</span>]] = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 四个方向及对应 WASD</span></span><br><span class="line">    directions = [(-<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;s&#x27;</span>), (<span class="number">1</span>, <span class="number">0</span>, <span class="string">&#x27;w&#x27;</span>), (<span class="number">0</span>, -<span class="number">1</span>, <span class="string">&#x27;d&#x27;</span>), (<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> queue:</span><br><span class="line">        x, y = queue.popleft()</span><br><span class="line">        <span class="keyword">if</span> (x, y) == end:</span><br><span class="line">            <span class="comment"># 回溯路径生成 WASD</span></span><br><span class="line">            path = []</span><br><span class="line">            <span class="keyword">while</span> parent[x][y] <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                px, py, move = parent[x][y]</span><br><span class="line">                path.append(move)</span><br><span class="line">                x, y = px, py</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(path[::-<span class="number">1</span>])  <span class="comment"># 反转得到正确顺序</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> dx, dy, move <span class="keyword">in</span> directions:</span><br><span class="line">            nx, ny = x + dx, y + dy</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= nx &lt; rows <span class="keyword">and</span> <span class="number">0</span> &lt;= ny &lt; cols:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> visited[nx][ny] <span class="keyword">and</span> maze[nx][ny] == <span class="number">0</span>:</span><br><span class="line">                    visited[nx][ny] = <span class="literal">True</span></span><br><span class="line">                    parent[nx][ny] = (x, y, move)</span><br><span class="line">                    queue.append((nx, ny))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span>  <span class="comment"># 无法到达终点</span></span><br><span class="line"></span><br><span class="line">start = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">end = (<span class="number">19</span>, <span class="number">19</span>)</span><br><span class="line">wasd_path = shortest_path_wasd(maze, start, end)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;WASD 最短路径:&quot;</span>, wasd_path)</span><br></pre></td></tr></table></figure>
<p>得到flag, <code>wwaaaaaaaawwwwddwwddwwaaaawwaaaaaassssaawwwwaawwwwwwwa</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202091003793.png" alt="image-20260202091003793" /></p>
<p>其实这道题可以学的更多的东西</p>
<ul>
<li>在定位的时候可以了解MFC的Dialog机制，包括<code>SendMessage</code>等windows消息队列机制。虽然在比赛中太慢了。</li>
<li>手动脱壳，然后逆向分析程序（还没试过）</li>
</ul>
<h1 id="2-delicious-obf"><a class="markdownIt-Anchor" href="#2-delicious-obf"></a> 2. delicious obf</h1>
<blockquote>
<p>能解出复杂的逆向题，却摸不透她的心。你能克服重重阻碍，找到隐藏在她内心深处的flag吗</p>
<blockquote>
<p>flag长度为32</p>
</blockquote>
</blockquote>
<p>字符串找到主要逻辑</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205180754535.png" alt="image-20260205180754535" /></p>
<p>跟一小段，到<code>0x14000655+4</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205180825850.png" alt="image-20260205180825850" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205180904948.png" alt="image-20260205180904948" /></p>
<p>第一段是正常指令，后续的是跳转的混淆的花指令，尝试使用ida提取出主要汇编，有<code>jmp</code>和<code>call</code>我是手动跟进去看的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"><span class="keyword">import</span> ida_ua</span><br><span class="line"><span class="keyword">import</span> idaapi</span><br><span class="line"><span class="keyword">import</span> ida_lines</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"></span><br><span class="line">START_ADDR = <span class="number">0x00140006560</span></span><br><span class="line">MAX_STEPS = <span class="number">200</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">force_code</span>(<span class="params">ea</span>):</span><br><span class="line">    <span class="comment"># 删除原有 item，强制当作 code</span></span><br><span class="line">    ida_bytes.del_items(ea, ida_bytes.DELIT_SIMPLE)</span><br><span class="line">    <span class="keyword">return</span> ida_ua.create_insn(ea)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_first_insn</span>(<span class="params">ea, limit=<span class="number">0x40</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从 ea 开始逐字节尝试 decode，找第一条有效指令</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    insn = ida_ua.insn_t()</span><br><span class="line">    cur = ea</span><br><span class="line">    end = ea + limit</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> cur &lt; end:</span><br><span class="line">        <span class="keyword">if</span> ida_ua.decode_insn(insn, cur):</span><br><span class="line">            <span class="keyword">return</span> cur, insn</span><br><span class="line">        cur += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> idaapi.BADADDR, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">format_insn</span>(<span class="params">ea</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    打印标准反汇编（避免乱码）</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    line = idc.generate_disasm_line(ea, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> line:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;--- 0x<span class="subst">&#123;ea:X&#125;</span>: <span class="subst">&#123;line&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;--- 0x<span class="subst">&#123;ea:X&#125;</span>: &lt;no disasm&gt;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_lea_r10</span>(<span class="params">start_ea, limit=<span class="number">0x200</span></span>):</span><br><span class="line">    insn = ida_ua.insn_t()</span><br><span class="line">    cur = start_ea</span><br><span class="line">    end = start_ea + limit</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> cur &lt; end:</span><br><span class="line">        ida_ua.create_insn(cur)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> ida_ua.decode_insn(insn, cur):</span><br><span class="line">            cur += <span class="number">1</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        mnem = insn.get_canon_mnem().lower()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mnem == <span class="string">&quot;lea&quot;</span>:</span><br><span class="line">            dis = idc.generate_disasm_line(cur, <span class="number">0</span>)</span><br><span class="line">            <span class="comment"># print(f&quot;    [SCAN] 0x&#123;cur:X&#125;: &#123;dis&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 直接用 print_operand，更稳</span></span><br><span class="line">            op0 = idc.print_operand(cur, <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> op0 <span class="keyword">and</span> op0.lower() == <span class="string">&quot;r10&quot;</span>:</span><br><span class="line">                new_base = idc.get_operand_value(cur, <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> cur, new_base</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> insn.size &gt; <span class="number">0</span>:</span><br><span class="line">            cur += insn.size</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            cur += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> idaapi.BADADDR, <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    addr = START_ADDR</span><br><span class="line">    step = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Follow trampoline chain start at 0x%X\n&quot;</span> % addr)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> step &lt; MAX_STEPS:</span><br><span class="line">        step += <span class="number">1</span></span><br><span class="line">        <span class="comment"># 1. 从 addr 开始强制为 code</span></span><br><span class="line">        force_code(addr)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 2. 找第一段有效汇编（第一条有效指令）</span></span><br><span class="line">        first_ea, first_insn = get_first_insn(addr)</span><br><span class="line">        <span class="keyword">if</span> first_ea == idaapi.BADADDR:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[-] No valid instruction near 0x%X&quot;</span> % addr)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        format_insn(first_ea)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3. 找第二段：lea r10, new_addr</span></span><br><span class="line">        lea_ea, new_base = find_lea_r10(first_ea)</span><br><span class="line">        <span class="keyword">if</span> lea_ea == idaapi.BADADDR <span class="keyword">or</span> <span class="keyword">not</span> new_base:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[!] lea r10 not found, stop.&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        addr = new_base + <span class="number">4</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Done.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p>最后一步步得到汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br></pre></td><td class="code"><pre><span class="line">--- 0x140006560: push    rbp</span><br><span class="line">--- 0x1400060BE: mov     rbp, rsp</span><br><span class="line">--- 0x140006181: and     rsp, 0FFFFFFFFFFFFFFF0h</span><br><span class="line">--- 0x140006095: sub     rsp, 240h</span><br><span class="line">--- 0x140006323: mov     [rbp+10h], rcx</span><br><span class="line">--- 0x140006583: mov     [rbp+18h], rdx</span><br><span class="line">--- 0x140006046: mov     rax, [rbp+10h]</span><br><span class="line">--- 0x140005E03: mov     rcx, rax</span><br><span class="line">--- 0x140005E9C: call    strlen</span><br><span class="line">--- 0x14000615C: mov     rcx, rax</span><br><span class="line">--- 0x140005FAA: mov     rdx, [rbp+10h]</span><br><span class="line">--- 0x140005E72: lea     rax, [rsp+1D0h]</span><br><span class="line">--- 0x140005EEA: mov     r8, rcx</span><br><span class="line">--- 0x1400065F4: mov     rcx, rax</span><br><span class="line">--- 0x14000623F: call    memcpy</span><br><span class="line">--- 0x140005E28: mov     rdx, [rbp+18h]</span><br><span class="line">--- 0x14000601C: lea     rax, [rsp+1D0h]</span><br><span class="line">--- 0x1400064A2: mov     rcx, rax</span><br><span class="line">--- 0x140006218: call    near ptr qword_1400043A8+0B6h</span><br><span class="line">    其中 RCX=输入,RDX==&gt;00007FF60B845070  67 75 7C 73 7F 7D 75 30 64 7F 30 66 7E 73 64 76  gu|s.&#125;u0d.0f~sdv  </span><br><span class="line">    实际代码：</span><br><span class="line">    --- 0x140004A7C: push    rbp</span><br><span class="line">    --- 0x140004C01: mov     rbp, rsp</span><br><span class="line">    --- 0x1400048D5: push    rbx</span><br><span class="line">    --- 0x140004E2D: sub     rsp, 48h</span><br><span class="line">    --- 0x140005494: mov     [rbp+10h], rcx</span><br><span class="line">    --- 0x14000511B: mov     [rbp+18h], rdx</span><br><span class="line">    --- 0x140005340: mov     dword ptr [rbp-14h], 0</span><br><span class="line">    --- 0x140004E01: jmp     near ptr unk_140004489</span><br><span class="line">    ----- jmp 后的实际代码</span><br><span class="line">        --- 0x140004F7B: mov     eax, [rbp-14h]</span><br><span class="line">        --- 0x140005245: movsxd  rbx, eax</span><br><span class="line">        --- 0x1400049D3: mov     rax, [rbp+10h]</span><br><span class="line">        --- 0x140004D2A: mov     rcx, rax</span><br><span class="line">        --- 0x1400045D2: call    strlen</span><br><span class="line">        --- 0x140004B7B: popfq</span><br><span class="line">        --- 0x140004CD3: mov     eax, 0</span><br><span class="line">        --- 0x1400048FD: mov     rbx, [rbp-8]</span><br><span class="line">        --- 0x140004503: leave</span><br><span class="line">        --- 0x140004FF8: int     3; Trap to Debugger</span><br><span class="line">        --- 0x140004DD2: retn</span><br><span class="line">    --- 0x1400049A9: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x140004855: cdqe</span><br><span class="line">    --- 0x140005398: mov     rdx, [rbp+10h]</span><br><span class="line">    --- 0x1400051C6: add     rax, rdx</span><br><span class="line">    --- 0x14000546A: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x140004DD7: movzx   eax, al</span><br><span class="line">    --- 0x14000536E: mov     [rbp-18h], eax</span><br><span class="line">    --- 0x14000519C: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x140005020: cdqe</span><br><span class="line">    --- 0x140004554: lea     rdx, [rax+1]</span><br><span class="line">    --- 0x1400047AC: mov     rax, [rbp+10h]</span><br><span class="line">    --- 0x140005416: add     rax, rdx</span><br><span class="line">    --- 0x1400044D9: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x140004D7E: movzx   eax, al</span><br><span class="line">    --- 0x140004C2B: mov     [rbp-1Ch], eax</span><br><span class="line">    --- 0x140004BD3: mov     dword ptr [rbp-20h], 0</span><br><span class="line">    --- 0x1400048A7: mov     dword ptr [rbp-28h], 9E3779B9h</span><br><span class="line">    --- 0x140004952: mov     dword ptr [rbp-24h], 0</span><br><span class="line">    --- 0x140005170: jmp     near ptr unk_140004AA8</span><br><span class="line">    -----jmp 后的实际代码</span><br><span class="line">        --- 0x140004AA8: cmp     dword ptr [rbp-24h], 1Fh</span><br><span class="line">        --- 0x14000462C: popfq</span><br><span class="line">        --- 0x1400052C3: mov     eax, [rbp-14h]</span><br><span class="line">        --- 0x140004F27: cdqe</span><br><span class="line">        --- 0x14000472C: mov     rdx, [rbp+10h]</span><br><span class="line">        --- 0x140004782: add     rax, rdx</span><br><span class="line">        --- 0x14000457F: mov     edx, [rbp-18h]</span><br><span class="line">        --- 0x140004A28: mov     [rax], dl</span><br><span class="line">        --- 0x1400050F1: mov     eax, [rbp-14h]</span><br><span class="line">        --- 0x1400047D7: cdqe</span><br><span class="line">        --- 0x140004CFF: lea     rdx, [rax+1]</span><br><span class="line">        --- 0x14000482A: mov     rax, [rbp+10h]</span><br><span class="line">        --- 0x140004AD4: add     rax, rdx</span><br><span class="line">        --- 0x140005146: mov     edx, [rbp-1Ch]</span><br><span class="line">        --- 0x140004B52: mov     [rax], dl</span><br><span class="line">        --- 0x140004485: add     dword ptr [rbp-14h], 2</span><br><span class="line">        --- 0x140004F7B: mov     eax, [rbp-14h]</span><br><span class="line">        --- 0x140005245: movsxd  rbx, eax</span><br><span class="line">        --- 0x1400049D3: mov     rax, [rbp+10h]</span><br><span class="line">        --- 0x140004D2A: mov     rcx, rax</span><br><span class="line">        --- 0x1400045D2: call    strlen</span><br><span class="line">        --- 0x140004B7B: popfq</span><br><span class="line">        --- 0x140004CD3: mov     eax, 0</span><br><span class="line">        --- 0x1400048FD: mov     rbx, [rbp-8]</span><br><span class="line">        --- 0x140004503: leave</span><br><span class="line">        --- 0x140004FF8: int     3; Trap to Debugger</span><br><span class="line">        --- 0x140004DD2: retn</span><br><span class="line">    --- 0x140004702: mov     eax, [rbp-28h]</span><br><span class="line">    --- 0x1400049FE: add     [rbp-20h], eax</span><br><span class="line">    --- 0x140004BA9: mov     eax, [rbp-1Ch]</span><br><span class="line">    --- 0x140004928: shl     eax, 4</span><br><span class="line">    --- 0x1400052ED: mov     edx, eax</span><br><span class="line">    --- 0x1400051F0: mov     rax, [rbp+18h]</span><br><span class="line">    --- 0x140004685: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x140005316: movzx   eax, al</span><br><span class="line">    --- 0x1400044B0: add     edx, eax</span><br><span class="line">    --- 0x140004800: mov     ecx, [rbp-1Ch]</span><br><span class="line">    --- 0x140004ED3: mov     eax, [rbp-20h]</span><br><span class="line">    --- 0x140004980: add     eax, ecx</span><br><span class="line">    --- 0x1400046D9: xor     edx, eax</span><br><span class="line">    --- 0x140004CA9: mov     eax, [rbp-1Ch]</span><br><span class="line">    --- 0x140005299: shr     eax, 5</span><br><span class="line">    --- 0x140004B29: mov     ecx, eax</span><br><span class="line">    --- 0x140004757: mov     rax, [rbp+18h]</span><br><span class="line">    --- 0x140004A51: add     rax, 1</span><br><span class="line">    --- 0x140004602: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x140004DA8: movzx   eax, al</span><br><span class="line">    --- 0x1400045A9: add     eax, ecx</span><br><span class="line">    --- 0x1400053C3: xor     eax, edx</span><br><span class="line">    --- 0x140004D54: add     [rbp-18h], eax</span><br><span class="line">    --- 0x140004C7F: mov     eax, [rbp-18h]</span><br><span class="line">    --- 0x140005440: shl     eax, 4</span><br><span class="line">    --- 0x140004E81: mov     edx, eax</span><br><span class="line">    --- 0x14000465A: mov     rax, [rbp+18h]</span><br><span class="line">    --- 0x140004AFE: add     rax, 2</span><br><span class="line">    --- 0x140004EFD: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x1400053EC: movzx   eax, al</span><br><span class="line">    --- 0x140004FCF: add     edx, eax</span><br><span class="line">    --- 0x14000509D: mov     ecx, [rbp-18h]</span><br><span class="line">    --- 0x14000526F: mov     eax, [rbp-20h]</span><br><span class="line">    --- 0x140004EAA: add     eax, ecx</span><br><span class="line">    --- 0x140005074: xor     edx, eax</span><br><span class="line">    --- 0x14000521B: mov     eax, [rbp-18h]</span><br><span class="line">    --- 0x1400046AF: shr     eax, 5</span><br><span class="line">    --- 0x140004E58: mov     ecx, eax</span><br><span class="line">    --- 0x140004F50: mov     rax, [rbp+18h]</span><br><span class="line">    --- 0x140005049: add     rax, 3</span><br><span class="line">    --- 0x140004FA5: movzx   eax, byte ptr [rax]</span><br><span class="line">    --- 0x1400050C7: movzx   eax, al</span><br><span class="line">    --- 0x14000452B: add     eax, ecx</span><br><span class="line">    --- 0x14000487E: xor     eax, edx</span><br><span class="line">    --- 0x140004C55: add     [rbp-1Ch], eax</span><br><span class="line">    --- 0x140004AA4: add     dword ptr [rbp-24h], 1</span><br><span class="line">    --- 0x14000462C: popfq</span><br><span class="line">    --- 0x1400052C3: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x140004F27: cdqe</span><br><span class="line">    --- 0x14000472C: mov     rdx, [rbp+10h]</span><br><span class="line">    --- 0x140004782: add     rax, rdx</span><br><span class="line">    --- 0x14000457F: mov     edx, [rbp-18h]</span><br><span class="line">    --- 0x140004A28: mov     [rax], dl</span><br><span class="line">    --- 0x1400050F1: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x1400047D7: cdqe</span><br><span class="line">    --- 0x140004CFF: lea     rdx, [rax+1]</span><br><span class="line">    --- 0x14000482A: mov     rax, [rbp+10h]</span><br><span class="line">    --- 0x140004AD4: add     rax, rdx</span><br><span class="line">    --- 0x140005146: mov     edx, [rbp-1Ch]</span><br><span class="line">    --- 0x140004B52: mov     [rax], dl</span><br><span class="line">    --- 0x140004485: add     dword ptr [rbp-14h], 2</span><br><span class="line">    --- 0x140004F7B: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x140005245: movsxd  rbx, eax</span><br><span class="line">    --- 0x1400049D3: mov     rax, [rbp+10h]</span><br><span class="line">    --- 0x140004D2A: mov     rcx, rax</span><br><span class="line">    --- 0x1400045D2: call    strlen</span><br><span class="line">    --- 0x140004B7B: popfq</span><br><span class="line">    --- 0x140004CD3: mov     eax, 0</span><br><span class="line">    --- 0x1400048FD: mov     rbx, [rbp-8]</span><br><span class="line">    --- 0x140004503: leave</span><br><span class="line">    --- 0x140004FF8: int     3; Trap to Debugger</span><br><span class="line">    --- 0x140004DD2: retn</span><br><span class="line">--- 0x140005F80: lea     rax, [rsp+1D0h]</span><br><span class="line">--- 0x1400064EC: mov     rcx, rax</span><br><span class="line">--- 0x140006451: call    strlen</span><br><span class="line">--- 0x1400065CF: mov     rdx, rax</span><br><span class="line">--- 0x140006478: lea     rax, [rsp+1D0h]</span><br><span class="line">--- 0x140005F0F: mov     r8, rdx</span><br><span class="line">--- 0x140006511: lea     rdx, unk_140015000</span><br><span class="line">--- 0x1400063E2: mov     rcx, rax</span><br><span class="line">--- 0x14000610C: call    memcmp</span><br><span class="line">--- 0x140006349: test    eax, eax</span><br><span class="line">--- 0x1400062B2: setz    al</span><br><span class="line">--- 0x140005FF7: movzx   eax, al</span><br><span class="line">--- 0x14000606C: mov     [rsp+23Ch], eax</span><br><span class="line">--- 0x1400061CE: lea     r8, [rsp+20h]</span><br><span class="line">--- 0x140005EC3: lea     rcx, [rsp+40h]</span><br><span class="line">--- 0x1400065A9: mov     rdx, [rbp+10h]</span><br><span class="line">--- 0x14000653A: mov     rax, [rbp+18h]</span><br><span class="line">--- 0x14000642C: mov     r9, r8</span><br><span class="line">--- 0x1400064C7: mov     r8, rcx</span><br><span class="line">--- 0x140006407: mov     rcx, rax</span><br><span class="line">--- 0x140005FD0: call    sub_1400054BB</span><br><span class="line">    实际代码：</span><br><span class="line">    --- 0x1400054BB: lea     r10, sub_140005C34</span><br><span class="line">    --- 0x140005C38: push    rbp</span><br><span class="line">    --- 0x14000598C: mov     rbp, rsp</span><br><span class="line">    --- 0x140005A34: push    rbx</span><br><span class="line">    --- 0x140005907: sub     rsp, 38h</span><br><span class="line">    --- 0x140005D13: mov     [rbp+10h], rcx</span><br><span class="line">    --- 0x14000553C: mov     [rbp+18h], rdx</span><br><span class="line">    --- 0x1400055BB: mov     [rbp+20h], r8</span><br><span class="line">    --- 0x1400056B8: mov     [rbp+28h], r9</span><br><span class="line">    --- 0x140005CE5: mov     dword ptr [rbp-14h], 0</span><br><span class="line">    --- 0x140005C0A: mov     dword ptr [rbp-18h], 0</span><br><span class="line">    --- 0x1400055E6: jmp     loc_140005510</span><br><span class="line">    -----jmp 后的实际代码</span><br><span class="line">        --- 0x140005510  cmp     dword ptr [rbp-18h], 0Fh</span><br><span class="line">        --- 0x140005514  pushfq</span><br><span class="line">        --- 0x140005BDC: popfq</span><br><span class="line">        --- 0x1400057DB: mov     dword ptr [rbp-14h], 0</span><br><span class="line">        --- 0x140005833: mov     dword ptr [rbp-1Ch], 0</span><br><span class="line">        --- 0x140005BB0: jmp     loc_140005668</span><br><span class="line">        --- 0x140005D90: mov     eax, [rbp-1Ch]</span><br><span class="line">        --- 0x14000588B: cdqe</span><br><span class="line">        --- 0x140005ADC: mov     rdx, [rbp+18h]</span><br><span class="line">        --- 0x140005B86: add     rax, rdx</span><br><span class="line">        --- 0x140005D3E: mov     ecx, [rax]</span><br><span class="line">        --- 0x140005C60: mov     r8, [rbp+20h]</span><br><span class="line">        --- 0x14000570D: mov     eax, [rbp-14h]</span><br><span class="line">        --- 0x1400054E2: lea     edx, [rax+1]</span><br><span class="line">        --- 0x140005809: mov     [rbp-14h], edx</span><br><span class="line">        --- 0x14000578A: cdqe</span><br><span class="line">        --- 0x140005567: shl     rax, 2</span><br><span class="line">        --- 0x140005A0A: add     rax, r8</span><br><span class="line">        --- 0x140005592: mov     [rax], ecx</span><br><span class="line">        --- 0x140005664: add     dword ptr [rbp-1Ch], 4</span><br><span class="line">        --- 0x140005A84: mov     eax, [rbp-1Ch]</span><br><span class="line">        --- 0x140005B31: movsxd  rbx, eax</span><br><span class="line">        --- 0x1400058B4: mov     rax, [rbp+18h]</span><br><span class="line">        --- 0x140005C8B: mov     rcx, rax</span><br><span class="line">        --- 0x140005CB5: call    strlen</span><br><span class="line">        --- 0x140005AAE: popfq</span><br><span class="line">        --- 0x140005937: mov     rbx, [rbp-8]</span><br><span class="line">        --- 0x1400057B3: leave</span><br><span class="line">        --- 0x140005A5C: int     3; Trap to Debugger</span><br><span class="line">        --- 0x140005932: retn</span><br><span class="line">    --- 0x140005760: mov     eax, [rbp-18h]</span><br><span class="line">    --- 0x1400059E1: cdqe</span><br><span class="line">    --- 0x1400059B6: mov     rdx, [rbp+10h]</span><br><span class="line">    --- 0x140005861: add     rax, rdx</span><br><span class="line">    --- 0x140005D67: mov     ecx, [rax]</span><br><span class="line">    --- 0x140005B5B: mov     r8, [rbp+28h]</span><br><span class="line">    --- 0x14000563A: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x140005962: lea     edx, [rax+1]</span><br><span class="line">    --- 0x140005B07: mov     [rbp-14h], edx</span><br><span class="line">    --- 0x14000568F: cdqe</span><br><span class="line">    --- 0x140005DBA: shl     rax, 2</span><br><span class="line">    --- 0x1400056E3: add     rax, r8</span><br><span class="line">    --- 0x140005737: mov     [rax], ecx</span><br><span class="line">    --- 0x14000550C: add     dword ptr [rbp-18h], 4</span><br><span class="line">    --- 0x140005BDC: popfq</span><br><span class="line">    --- 0x1400057DB: mov     dword ptr [rbp-14h], 0</span><br><span class="line">    --- 0x140005833: mov     dword ptr [rbp-1Ch], 0</span><br><span class="line">    --- 0x140005BB0: jmp     loc_140005668</span><br><span class="line">    -----jmp 后的实际代码</span><br><span class="line">        --- 0x140005A84: mov     eax, [rbp-1Ch]</span><br><span class="line">        --- 0x140005B31: movsxd  rbx, eax</span><br><span class="line">        --- 0x1400058B4: mov     rax, [rbp+18h]</span><br><span class="line">        --- 0x140005C8B: mov     rcx, rax</span><br><span class="line">        --- 0x140005CB5: call    strlen</span><br><span class="line">        --- 0x140005AAE: popfq</span><br><span class="line">        --- 0x1400058DF: nop</span><br><span class="line">        --- 0x140005612: nop</span><br><span class="line">        --- 0x140005937: mov     rbx, [rbp-8]</span><br><span class="line">        --- 0x1400057B3: leave</span><br><span class="line">        --- 0x140005A5C: int     3; Trap to Debugger</span><br><span class="line">        --- 0x140005932: retn</span><br><span class="line">    --- 0x140005D90: mov     eax, [rbp-1Ch]</span><br><span class="line">    --- 0x14000588B: cdqe</span><br><span class="line">    --- 0x140005ADC: mov     rdx, [rbp+18h]</span><br><span class="line">    --- 0x140005B86: add     rax, rdx</span><br><span class="line">    --- 0x140005D3E: mov     ecx, [rax]</span><br><span class="line">    --- 0x140005C60: mov     r8, [rbp+20h]</span><br><span class="line">    --- 0x14000570D: mov     eax, [rbp-14h]</span><br><span class="line">    --- 0x1400054E2: lea     edx, [rax+1]</span><br><span class="line">    --- 0x140005809: mov     [rbp-14h], edx</span><br><span class="line">    --- 0x14000578A: cdqe</span><br><span class="line">    --- 0x140005567: shl     rax, 2</span><br><span class="line">    --- 0x140005A0A: add     rax, r8</span><br><span class="line">    --- 0x140005592: mov     [rax], ecx</span><br><span class="line">    --- 0x140005664: add     dword ptr [rbp-1Ch], 4</span><br><span class="line">    --- 0x140005A84: mov     eax, [rbp-1Ch]</span><br><span class="line">    --- 0x140005B31: movsxd  rbx, eax</span><br><span class="line">    --- 0x1400058B4: mov     rax, [rbp+18h]</span><br><span class="line">    --- 0x140005C8B: mov     rcx, rax</span><br><span class="line">    --- 0x140005CB5: call    strlen</span><br><span class="line">    --- 0x140005AAE: popfq</span><br><span class="line">    --- 0x1400058DF: nop</span><br><span class="line">    --- 0x140005612: nop</span><br><span class="line">    --- 0x140005937: mov     rbx, [rbp-8]</span><br><span class="line">    --- 0x1400057B3: leave</span><br><span class="line">    --- 0x140005A5C: int     3; Trap to Debugger</span><br><span class="line">    --- 0x140005932: retn</span><br><span class="line">--- 0x140005F5A: mov     rax, [rbp+10h]</span><br><span class="line">--- 0x140006372: mov     rcx, rax</span><br><span class="line">--- 0x1400061A7: call    strlen</span><br><span class="line">--- 0x140005F34: shr     rax, 2</span><br><span class="line">--- 0x140006397: mov     ecx, eax</span><br><span class="line">--- 0x1400062FC: lea     rdx, [rsp+20h]</span><br><span class="line">--- 0x1400063BB: lea     rax, [rsp+40h]</span><br><span class="line">--- 0x14000628D: mov     r8, rdx</span><br><span class="line">--- 0x140005E4E: mov     edx, ecx</span><br><span class="line">--- 0x1400062D7: mov     rcx, rax</span><br><span class="line">--- 0x140006266: call    loc_140001977</span><br><span class="line">    实际代码：</span><br><span class="line">    --- 0x140001977                 and     [rcx+rax*8], ebp</span><br><span class="line">    --- 0x14000197A                 mov     eax, ds:576526BE8120076Eh</span><br><span class="line">    --- 0x140001983                 outsd</span><br><span class="line">    --- 0x140001984                 pushfq</span><br><span class="line">    --- 0x140001986                 push    0FFFFFFFFFFFFFFD7h</span><br><span class="line">    --- 0x140001988                 push    79h ; &#x27;y&#x27;</span><br><span class="line">    --- 0x14000198A                 db      46h</span><br><span class="line">    --- 0x14000198A                 cld</span><br><span class="line">    --- 0x14000198D                 outsb</span><br><span class="line">--- 0x140006133: mov     [rsp+238h], eax</span><br><span class="line">--- 0x1400060E3: mov     eax, [rsp+238h]</span><br><span class="line">--- 0x1400061F5: leave</span><br><span class="line">--- 0x14000636D: retn</span><br></pre></td></tr></table></figure>
<p>这一步我就卡死了，在疑似tea的那段不管是调试还是写hook，都只能把加密算法拿出来，但是<code>memcmp</code>哪里我哪怕修改成为正确的结果也无法通过检验</p>
<p>后来看了 <a target="_blank" rel="noopener" href="https://singlehorn.github.io/2026/02/04/VNCTF2026%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">VNCTF2026 出题笔记</a> 出题人是手动patch混淆的<code>lea</code>为<code>jmp</code>后如果ida识别为函数，可以使用ida的<code> Append function tail</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205182911505.png" alt="image-20260205182911505" /></p>
<blockquote>
<p>#  Post author: Y&amp;Y @保持好奇心<br />
#  Post link: <a target="_blank" rel="noopener" href="http://example.com/2026/02/04/VNCTF2026%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">http://example.com/2026/02/04/VNCTF2026出题笔记/</a><br />
#  Copyright Notice: All articles in this blog are licensed under (CC)BY-NC-SA unless stating additionally.</p>
<p>那么先 Edit -&gt; Functions -&gt; Delete function 删除函数，再选中这些汇编 Append function tail 把他们并入到函数 sub_1400054BB 中</p>
</blockquote>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205185419696.png" alt="image-20260205185419696" /></p>
<h2 id="sub_14000445e"><a class="markdownIt-Anchor" href="#sub_14000445e"></a> sub_14000445E</h2>
<p>这个部分我通过自己的分析得到了加密的python函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">DELTA = <span class="number">0x9E3779B9</span></span><br><span class="line">ROUNDS = <span class="number">32</span></span><br><span class="line">KEY_BYTES = <span class="built_in">bytes</span>([</span><br><span class="line">    <span class="number">0x67</span>, <span class="number">0x75</span>, <span class="number">0x7C</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x7F</span>, <span class="number">0x7D</span>, <span class="number">0x75</span>, <span class="number">0x30</span>,</span><br><span class="line">    <span class="number">0x64</span>, <span class="number">0x7F</span>, <span class="number">0x30</span>, <span class="number">0x66</span>,</span><br><span class="line">    <span class="number">0x7E</span>, <span class="number">0x73</span>, <span class="number">0x64</span>, <span class="number">0x76</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">u32</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_pair</span>(<span class="params">v0, v1, key</span>):</span><br><span class="line">    v0 = u32(v0)</span><br><span class="line">    v1 = u32(v1)</span><br><span class="line"></span><br><span class="line">    k0 = key[<span class="number">0</span>]</span><br><span class="line">    k1 = key[<span class="number">1</span>]</span><br><span class="line">    k2 = key[<span class="number">2</span>]</span><br><span class="line">    k3 = key[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    s = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(ROUNDS):</span><br><span class="line">        s = u32(s + DELTA)</span><br><span class="line">        v0 = u32(v0 + (</span><br><span class="line">            ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^</span><br><span class="line">            (v1 + s) ^</span><br><span class="line">            ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        ))</span><br><span class="line">        v1 = u32(v1 + (</span><br><span class="line">            ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^</span><br><span class="line">            (v0 + s) ^</span><br><span class="line">            ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        ))</span><br><span class="line">    <span class="keyword">return</span> v0 &amp; <span class="number">0xFF</span>, v1 &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_bytes</span>(<span class="params">data: <span class="built_in">bytes</span>, key4</span>):</span><br><span class="line">    out = <span class="built_in">bytearray</span>()</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(data):</span><br><span class="line">        v0 = data[i]</span><br><span class="line">        v1 = data[i+<span class="number">1</span>] <span class="keyword">if</span> i+<span class="number">1</span> &lt; <span class="built_in">len</span>(data) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        c0, c1 = encrypt_pair(v0, v1, key4)</span><br><span class="line">        out.append(c0)</span><br><span class="line">        out.append(c1)</span><br><span class="line"></span><br><span class="line">        i += <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(out)</span><br></pre></td></tr></table></figure>
<p>这一点我用hook和调试确保代码是正确的，但是不知道为啥<code>KEY_BYTES</code>和ida中的预期不一样</p>
<h2 id="sub_1400054bb"><a class="markdownIt-Anchor" href="#sub_1400054bb"></a> sub_1400054BB</h2>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205191023437.png" alt="image-20260205191023437" /></p>
<p>没招了，直接问AI</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140005907</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">char</span> *src1,   <span class="comment">// a1</span></span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">char</span> *src2,   <span class="comment">// a2</span></span></span><br><span class="line"><span class="params">    <span class="type">int</span> *out1,          <span class="comment">// a3</span></span></span><br><span class="line"><span class="params">    <span class="type">int</span> *out2           <span class="comment">// a4</span></span></span><br><span class="line"><span class="params">)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> count1 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> count2 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy src1 bytes into out2 as ints</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; src1[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        out2[count1++] = (<span class="type">unsigned</span> <span class="type">char</span>)src1[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Copy src2 bytes into out1 as ints</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; src2[i] != <span class="string">&#x27;\0&#x27;</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        out1[count2++] = (<span class="type">unsigned</span> <span class="type">char</span>)src2[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sub_140005A5C();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="loc_14000670b"><a class="markdownIt-Anchor" href="#loc_14000670b"></a> loc_14000670B</h2>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205191208019.png" alt="image-20260205191208019" /></p>
<p>乱码，wp上写的是可以找到交叉引用，但是我的IDA在之前的去花指令后的效果有巨大不同。在我自己的ida脚本中也是的不出这一段的反汇编。不急hook<code>sub_140006095</code>后进行dump</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205192152043.png" alt="image-20260205192152043" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205192317865.png" alt="image-20260205192317865" /></p>
<p>测试发现函数长度0x15B，手动覆写回去</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205194509264.png" alt="image-20260205194509264" /></p>
<p>还原的非常漂亮，解密算法直接喂给AI</p>
<p>wp中说这一段</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploads69821c1a4f83a817d7f86b6c.png" alt="img" /></p>
<blockquote>
<p>#  Post author: Y&amp;Y @保持好奇心<br />
#  Post link: <a target="_blank" rel="noopener" href="http://example.com/2026/02/04/VNCTF2026%E5%87%BA%E9%A2%98%E7%AC%94%E8%AE%B0/">http://example.com/2026/02/04/VNCTF2026出题笔记/</a><br />
#  Copyright Notice: All articles in this blog are licensed under (CC)BY-NC-SA unless stating additionally.</p>
<p>发现如果有 int 3 中断，就对 loc_140001977 进行 smc，这里其实可以起一个反调试的作用，因为软件断点的原理就是把断点处汇编的第一个字节改为 0xCC。</p>
</blockquote>
<p>但是我的ida一直都调不出来…</p>
<h2 id="得到flag"><a class="markdownIt-Anchor" href="#得到flag"></a> 得到flag</h2>
<p>根据程序直接拿到密文</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205200320976.png" alt="image-20260205200320976" /></p>
<p>key有点麻烦，但是hook不麻烦。注意，这里不要直接Hook，估计是有SMC自解码，在解密之前都是这段乱码，如果你在解密之前hook，会造成解密失败</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205201750285.png" alt="image-20260205201750285" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260205201813892.png" alt="image-20260205201813892" /></p>
<p>最后</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">tea_decrypt</span><span class="params">(<span class="type">uint32_t</span>* buf, <span class="type">int</span> len, <span class="type">uint32_t</span>* key)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 先把 sum 走到加密结束时的位置</span></span><br><span class="line">    <span class="comment">// 每个 block 32 轮，每轮 sum += delta</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">31</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            sum += <span class="number">0x61C88647</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 现在倒序解密</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = len - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i -= <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint32_t</span> v0 = buf[i];</span><br><span class="line">        <span class="type">uint32_t</span> v1 = buf[i + <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt;= <span class="number">31</span>; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            v0 += (v1 + ((v1 &lt;&lt; <span class="number">4</span>) ^ (v1 &gt;&gt; <span class="number">5</span>)))</span><br><span class="line">                ^ (key[sum &amp; <span class="number">3</span>] + sum);</span><br><span class="line"></span><br><span class="line">            sum -= <span class="number">0x61C88647</span>;</span><br><span class="line">            v1 += (v0 + ((v0 &lt;&lt; <span class="number">4</span>) ^ (v0 &gt;&gt; <span class="number">5</span>)))</span><br><span class="line">                ^ (key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        buf[i] = v0;</span><br><span class="line">        buf[i + <span class="number">1</span>] = v1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">uint32_t</span> buf[] = &#123; <span class="number">0x738EA1B9</span>, <span class="number">0xF5B06584</span>, <span class="number">0xDCF952D5</span>, <span class="number">0x6FC28041</span>,<span class="number">0x1DA40CF1</span>, <span class="number">0x07572A62</span>, <span class="number">0xB4C49903</span>, <span class="number">0x9BA536D8</span> &#125;;</span><br><span class="line">    <span class="type">uint32_t</span> key[] = &#123; <span class="number">0xF9B2917F</span>, <span class="number">0x2A9D0847</span>, <span class="number">0x0C874A13</span>, <span class="number">0xA0253AD3</span> &#125;;</span><br><span class="line"></span><br><span class="line">    tea_decrypt(buf, <span class="number">8</span>, key);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (buf[i] &gt;&gt; (j * <span class="number">8</span>)) &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//VNCTF&#123;N0w_Y0u_Kn0w_SMC_4nd_@bf!&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="3-shadow"><a class="markdownIt-Anchor" href="#3-shadow"></a> 3. Shadow</h1>
<blockquote>
<p>说明：</p>
<ul>
<li>推荐在虚拟机Windows10-11运行该驱动。</li>
<li>自行配备环境或签名用于加载驱动。</li>
<li>请先运行.exe再加载驱动。</li>
<li>flag格式：VNCTF{你的输入}</li>
</ul>
<p>谍影重重的迷宫，你能通过迷宫成功攻击宿主电脑吗？</p>
</blockquote>
<p>还是第一次做这种驱动逆向，看了下题，不知道要干嘛，就去看obf那道题了</p>
<p>看<a target="_blank" rel="noopener" href="https://tkazer.github.io/2026/02/02/VNCTF2026-Shadow-WP/">VNCTF2026-Shadow-WP</a>的WP，是从exe的逆向开始</p>
<p>走迷宫</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202092903432.png" alt="image-20260202092903432" /></p>
<p>然后开始分析驱动</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202093501826.png" alt="image-20260202093501826" /></p>
<p><code>doSomeToPool</code>，问问AI</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202093819380.png" alt="image-20260202093819380" /></p>
<h2 id="aes"><a class="markdownIt-Anchor" href="#aes"></a> AES</h2>
<h3 id="静态python脚本"><a class="markdownIt-Anchor" href="#静态python脚本"></a> 静态+python脚本</h3>
<p><code>sub_140001168</code>AES加密过程，这个可以用插件找到S盒特征然后得出。拼接方式为ECB模式</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploads7dce1c466ce04bea88c09a3f448c1bc2_720.png" alt="7dce1c466ce04bea88c09a3f448c1bc2_720" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202102702381.png" alt="image-20260202102702381" /></p>
<ol>
<li>
<p>字节代换</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202101924064.png" alt="image-20260202101924064" /></p>
<p>标准S盒</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202101907052.png" alt="image-20260202101907052" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202102001588.png" alt="image-20260202102001588" /></p>
</li>
<li>
<p>行移位</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202101513612.png" alt="image-20260202101513612" /></p>
</li>
<li>
<p>列混淆</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202101552132.png" alt="image-20260202101552132" /></p>
</li>
</ol>
<p>编写脚本看看数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_ecb_encrypt</span>(<span class="params">plaintext: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    AES ECB 加密，自动 PKCS7 填充</span></span><br><span class="line"><span class="string">    key 长度必须是 16 / 24 / 32 字节</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    ct = cipher.encrypt(pad(plaintext, AES.block_size))</span><br><span class="line">    <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_ecb_decrypt</span>(<span class="params">ciphertext: <span class="built_in">bytes</span>, key: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    pt = unpad(cipher.decrypt(ciphertext), AES.block_size)</span><br><span class="line">    <span class="keyword">return</span> pt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    key = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;E9 BB 39 19 8B F5 CC BD E2 F0 55 93 11 18 98 CB&quot;</span>)</span><br><span class="line">    data = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;...&quot;</span>)</span><br><span class="line"></span><br><span class="line">    enc = aes_ecb_encrypt(data, key)</span><br><span class="line">    dec = aes_ecb_decrypt(enc, key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># print(&quot;Plain :&quot;, data)</span></span><br><span class="line">    <span class="comment"># print(&quot;Cipher:&quot;, enc[:0x10])</span></span><br><span class="line">    <span class="comment"># print(&quot;Decryp:&quot;, dec)</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;mem_pe.exe&quot;</span>, <span class="string">&quot;b+a&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(enc)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202103709426.png" alt="image-20260202103709426" /></p>
<h2 id="windbg"><a class="markdownIt-Anchor" href="#windbg"></a> windbg</h2>
<p>可以添加相关的符号类型便于逆向</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202132703480.png" alt="image-20260202132703480" /></p>
<p>右键过后添加<code>ntddk</code>,<code>wdk</code>之类的</p>
<p>这里也可以尝试使用windbg调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sxe ld Shadow</span><br></pre></td></tr></table></figure>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202111008159.png" alt="image-20260202111008159" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202111825618.png" alt="image-20260202111825618" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.writemem D:\CTF\vnctf\re\125431_Shadow\dump.exe ffffad82253aa000 ffffad82253aa000+5e00</span><br></pre></td></tr></table></figure>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202112148363.png" alt="image-20260202112148363" /></p>
<p>文件大小不一样，但是有效的PE文件大小是一样的</p>
<h3 id="pe映射"><a class="markdownIt-Anchor" href="#pe映射"></a> PE映射</h3>
<p>由于我自己做过反射式dll注入的，这个也差不多（有AI其实并不难），只不过映射的是Sys PE，这里修改下类型变得好看一些</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202114301781.png" alt="image-20260202114301781" /></p>
<p>导入IAT</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202114210846.png" alt="image-20260202114210846" /></p>
<h2 id="newpe"><a class="markdownIt-Anchor" href="#newpe"></a> NewPE</h2>
<p>上来就是个解密</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsuploadsimage-20260202124259700.png" alt="image-20260202124259700" /></p>
<p>还原</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cipher = [<span class="number">0xF1</span>, <span class="number">0xBB</span>, <span class="number">0xD9</span>, <span class="number">0xBD</span>, <span class="number">0xFA</span>, <span class="number">0xBF</span>, <span class="number">0xA5</span>, <span class="number">0xC1</span>, <span class="number">0xAE</span>, <span class="number">0xC3</span>, <span class="number">0xA5</span>, <span class="number">0xC5</span>, <span class="number">0xBF</span>, <span class="number">0xBA</span>, <span class="number">0xFE</span>, <span class="number">0xBC</span>, <span class="number">0xC5</span>, <span class="number">0xBE</span>, <span class="number">0xDA</span>, <span class="number">0xC0</span>, <span class="number">0xA2</span>, <span class="number">0xC2</span>,</span><br><span class="line">          <span class="number">0xB6</span>, <span class="number">0xC4</span>, <span class="number">0xB1</span>, <span class="number">0xC6</span>, <span class="number">0xD3</span>, <span class="number">0xBB</span>, <span class="number">0xD3</span>, <span class="number">0xBD</span>, <span class="number">0xD0</span>, <span class="number">0xBF</span>, <span class="number">0x94</span>, <span class="number">0xC1</span>, <span class="number">0xAA</span>, <span class="number">0xC3</span>, <span class="number">0xB6</span>, <span class="number">0xC5</span>, <span class="number">0xA3</span>, <span class="number">0xBA</span>, <span class="number">0xDA</span>, <span class="number">0xBC</span>, <span class="number">0xD9</span>, <span class="number">0xBE</span>, <span class="number">0xBF</span>, <span class="number">0xC0</span>]</span><br><span class="line">plaintest = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x2E</span>):</span><br><span class="line">    plaintest.append(cipher[i] ^ (i % <span class="number">0xD</span>+<span class="number">0xBA</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(plaintest).decode(<span class="string">&quot;utf-16-le&quot;</span>).rstrip(<span class="string">&quot;\x00&quot;</span>))</span><br><span class="line"><span class="comment">#KeDelayExecutionThread</span></span><br></pre></td></tr></table></figure>
<p>然后遍历Process找到<strong>宽字节</strong>的<code>Maze.exe</code>程序</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202130900416.png" alt="image-20260202130900416" /></p>
<h3 id="pte-hook"><a class="markdownIt-Anchor" href="#pte-hook"></a> PTE Hook</h3>
<p>这个就是我的知识盲区了（已添加到TodoList）,大致是通过修改物理页到虚拟页的映射来进行hook</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">原函数VA → 原物理页</span><br><span class="line">        ↓</span><br><span class="line">修改PTE</span><br><span class="line">        ↓</span><br><span class="line">原函数VA → Hook代码物理页</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>KeDelayExecutionThread</strong> 例程将当前线程置于指定间隔内可发出警报或不可更改的等待状态。</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">NTSTATUS KeDelayExecutionThread(</span><br><span class="line">[in] KPROCESSOR_MODE WaitMode,</span><br><span class="line">[in] BOOLEAN         Alertable,</span><br><span class="line">[in] PLARGE_INTEGER  Interval</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后设置IRP类型，又解密Device的unicode名字。</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202133339698.png" alt="image-20260202133339698" /></p>
<p><code>\Device\KeyboardClass0</code>是由 <strong>kbdclass.sys</strong> 创建的键盘类设备对象。附加键盘驱动上，此时<code>doIrpREAD</code>就会接收到键盘相关消息。</p>
<h3 id="doirpread"><a class="markdownIt-Anchor" href="#doirpread"></a> doIrpREAD</h3>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202133747911.png" alt="image-20260202133747911" /></p>
<p><code>CompletionRoutine</code></p>
<p>先出两个加密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[LDriver] on input.</span><br><span class="line"></span><br><span class="line">[LDriver] input end.</span><br></pre></td></tr></table></figure>
<p>这是在 IRP_MJ_READ 完成后，从键盘输入缓冲区里解析扫描码，维护 Shift 状态，并把按键转换成 ASCII，然后存到内部缓冲区。</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202135359536.png" alt="image-20260202135359536" /></p>
<p>相当于内核的键盘记录器，按下F12，输入flag，再按下F12，最后迷宫走到E判断flag</p>
<h3 id="newkedelayexecutionthread"><a class="markdownIt-Anchor" href="#newkedelayexecutionthread"></a> NewKeDelayExecutionThread</h3>
<p>其实应该一开始就分析这段代码的，但是变量太杂、信息不全，看不出是干嘛的，这时候返回去看会发现引用了记录Key的数组</p>
<ol>
<li>
<p>弄了一个很大的数</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202140714583.png" alt="image-20260202140714583" /></p>
</li>
<li>
<p>一堆自定义的加密</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202140740332.png" alt="image-20260202140740332" /></p>
<p><code>enc2</code>就是简单移位</p>
</li>
<li>
<p>最后一轮加密然后比较，应当有40字节成功，比较成功就蓝屏</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202140817824.png" alt="image-20260202140817824" /></p>
</li>
</ol>
<h3 id="动态调用"><a class="markdownIt-Anchor" href="#动态调用"></a> 动态调用</h3>
<p>主要是<code> (v24)(KeylogBuffer, jj_2 + len, &amp;MaybeKey);</code>这一段经过了大段的加密，尝试动态调试</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202143022637.png" alt="image-20260202143022637" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202143353802.png" alt="image-20260202143353802" /></p>
<p>有其他的call，直接全部dump下来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.writemem D:\CTF\vnctf\re\125431_Shadow\dump_shellcode.exe ffffc98e`8b561210 ffffc98e`8b561a71</span><br></pre></td></tr></table></figure>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202145923299.png" alt="image-20260202145923299" /></p>
<p>精准戳中密码学功底，没招了，看上去像是RC4的结构。</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202151733562.png" alt="image-20260202151733562" /></p>
<h2 id="最后的解密"><a class="markdownIt-Anchor" href="#最后的解密"></a> 最后的解密</h2>
<ol>
<li>
<p>得到最后的Key</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202155503021.png" alt="image-20260202155503021" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202163624570.png" alt="image-20260202163624570" /></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Key=0xe7d1cc85d2172c16</span><br></pre></td></tr></table></figure>
<p>后续的shellcode加密也可以检验</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202163939920.png" alt="image-20260202163939920" /></p>
</li>
<li>
<p>查看校验的答案</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202164014334.png" alt="image-20260202164014334" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202164244544.png" alt="image-20260202164244544" /></p>
</li>
</ol>
<p>结合赛后看的wp的解密方法解密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROR32(x, n) (((x) &gt;&gt; (n)) | ((x) &lt;&lt; (32u - (n))))</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ROL32(x, n) (((x) <span class="string">&lt;&lt; (n)) | ((x) &gt;</span>&gt; (32u - (n))))</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">xorshift32</span><span class="params">(<span class="type">uint32_t</span>* s)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> x = *s;</span><br><span class="line">    x ^= x &lt;&lt; <span class="number">13</span>;</span><br><span class="line">    x ^= x &gt;&gt; <span class="number">17</span>;</span><br><span class="line">    x ^= x &lt;&lt; <span class="number">5</span>;</span><br><span class="line">    *s = x;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">gen_sbox</span><span class="params">(<span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">2</span>], <span class="type">uint8_t</span> sbox[<span class="number">256</span>], <span class="type">uint8_t</span> inv[<span class="number">256</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">        sbox[i] = (<span class="type">uint8_t</span>)i;</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> seed = k[<span class="number">0</span>] ^ ROL32(k[<span class="number">1</span>], <span class="number">11</span>) ^ <span class="number">0xA5A5A5A5</span>u ^ <span class="number">0xB7E15163</span>u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">255</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint32_t</span> r = xorshift32(&amp;seed);</span><br><span class="line">        <span class="type">int</span> j = (<span class="type">int</span>)(r % (<span class="type">uint32_t</span>)(i + <span class="number">1</span>));</span><br><span class="line">        <span class="type">uint8_t</span> tmp = sbox[i];</span><br><span class="line">        sbox[i] = sbox[j];</span><br><span class="line">        sbox[j] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</span><br><span class="line">        inv[sbox[i]] = (<span class="type">uint8_t</span>)i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">inv_sub_bytes32</span><span class="params">(<span class="type">uint32_t</span> x, <span class="type">const</span> <span class="type">uint8_t</span> inv[<span class="number">256</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">uint32_t</span>)inv[(x &gt;&gt; <span class="number">0</span>) &amp; <span class="number">0xFF</span>] &lt;&lt; <span class="number">0</span> |</span><br><span class="line">        (<span class="type">uint32_t</span>)inv[(x &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>] &lt;&lt; <span class="number">8</span> |</span><br><span class="line">        (<span class="type">uint32_t</span>)inv[(x &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>] &lt;&lt; <span class="number">16</span> |</span><br><span class="line">        (<span class="type">uint32_t</span>)inv[(x &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xFF</span>] &lt;&lt; <span class="number">24</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">expand_key</span><span class="params">(<span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">2</span>], <span class="type">uint32_t</span> rk[<span class="number">32</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> a = k[<span class="number">0</span>] ^ <span class="number">0xB7E15163</span>u;</span><br><span class="line">    <span class="type">uint32_t</span> b = k[<span class="number">1</span>] + <span class="number">0x9E3779B9</span>u;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint32_t</span> t = (a ^ ROL32(b, (a &amp; <span class="number">31u</span>))) + (<span class="number">0xB7E15163</span>u ^ (i * <span class="number">0x9E3779B9</span>u));</span><br><span class="line">        rk[i] = t ^ ROR32(a + b, (b &amp; <span class="number">31u</span>));</span><br><span class="line">        a = b ^ rk[i];</span><br><span class="line">        b = t + ROL32(rk[i], (t &amp; <span class="number">31u</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">tweak32</span><span class="params">(<span class="type">uint32_t</span> idx, <span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">2</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> t = (idx + <span class="number">1u</span>) * <span class="number">0x45D9F3B</span>u;</span><br><span class="line">    t ^= ROL32(k[<span class="number">0</span>], (idx &amp; <span class="number">31u</span>));</span><br><span class="line">    t += (k[<span class="number">1</span>] ^ <span class="number">0xDEADBEEF</span>u);</span><br><span class="line">    t ^= t &gt;&gt; <span class="number">16</span>;</span><br><span class="line">    t *= <span class="number">0x7FEB352D</span>u;</span><br><span class="line">    t ^= t &gt;&gt; <span class="number">15</span>;</span><br><span class="line">    t *= <span class="number">0x846CA68B</span>u;</span><br><span class="line">    t ^= t &gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt_block</span><span class="params">(<span class="type">uint32_t</span> v[<span class="number">2</span>], <span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">2</span>],</span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">uint32_t</span> rk[<span class="number">32</span>],</span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">uint8_t</span> sbox[<span class="number">256</span>],</span></span><br><span class="line"><span class="params">    <span class="type">const</span> <span class="type">uint8_t</span> inv[<span class="number">256</span>],</span></span><br><span class="line"><span class="params">    <span class="type">uint32_t</span> block_index)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint32_t</span> x = v[<span class="number">0</span>], y = v[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> tw = tweak32(block_index, k);</span><br><span class="line"></span><br><span class="line">    x ^= (k[<span class="number">1</span>] + ROL32(tw, <span class="number">11</span>));</span><br><span class="line">    y ^= (k[<span class="number">0</span>] ^ tw);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        sum += (<span class="number">0xB7E15163</span>u ^ rk[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> r = <span class="number">0</span>; r &lt; <span class="number">32</span>; r++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint32_t</span> i = <span class="number">32</span> - <span class="number">1u</span> - r;</span><br><span class="line">        <span class="keyword">if</span> (sum &amp; <span class="number">1u</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">uint32_t</span> tmp = x;</span><br><span class="line">            x = y;</span><br><span class="line">            y = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">uint32_t</span> rotX = ((y ^ sum) + (rk[i] &gt;&gt; <span class="number">1</span>)) &amp; <span class="number">31u</span>;</span><br><span class="line">        x = ROR32(x, rotX);</span><br><span class="line"></span><br><span class="line">        y -= (x ^ rk[i]);</span><br><span class="line"></span><br><span class="line">        <span class="type">uint32_t</span> rotY = (<span class="type">uint32_t</span>)sbox[x &amp; <span class="number">0xFF</span>u] &amp; <span class="number">31u</span>;</span><br><span class="line">        y = ROL32(y, rotY);</span><br><span class="line"></span><br><span class="line">        x ^= (y + ROR32(sum, <span class="number">3</span>)) ^ ROL32(rk[i], (y &amp; <span class="number">31u</span>));</span><br><span class="line"></span><br><span class="line">        x -= (sum ^ rk[i]);</span><br><span class="line"></span><br><span class="line">        x = inv_sub_bytes32(x, inv);</span><br><span class="line">        y = inv_sub_bytes32(y, inv);</span><br><span class="line"></span><br><span class="line">        sum -= (<span class="number">0xB7E15163</span>u ^ rk[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    x ^= (k[<span class="number">0</span>] + tw);</span><br><span class="line">    y ^= (k[<span class="number">1</span>] ^ ROR32(tw, <span class="number">7</span>));</span><br><span class="line"></span><br><span class="line">    v[<span class="number">0</span>] = x;</span><br><span class="line">    v[<span class="number">1</span>] = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">decrypt</span><span class="params">(<span class="type">uint8_t</span>* buf, <span class="type">size_t</span> len, <span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">2</span>])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint8_t</span> sbox[<span class="number">256</span>], inv[<span class="number">256</span>];</span><br><span class="line">    <span class="type">uint32_t</span> rk[<span class="number">32</span>];</span><br><span class="line">    gen_sbox(k, sbox, inv);</span><br><span class="line">    expand_key(k, rk);</span><br><span class="line"></span><br><span class="line">    <span class="type">uint32_t</span> idx = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> off = <span class="number">0</span>; off + <span class="number">8</span> &lt;= len; off += <span class="number">8</span>, idx++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">uint32_t</span> v[<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">memcpy</span>(v, buf + off, <span class="number">8</span>);</span><br><span class="line">        decrypt_block(v, k, rk, sbox, inv, idx);</span><br><span class="line">        <span class="built_in">memcpy</span>(buf + off, v, <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">uint64_t</span> Key = <span class="number">0xe7d1cc85d2172c16</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> cipher[] =</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="number">0x51</span>, <span class="number">0xDA</span>, <span class="number">0xB8</span>, <span class="number">0x52</span>, <span class="number">0x73</span>, <span class="number">0xB9</span>, <span class="number">0x17</span>, <span class="number">0x00</span>, <span class="number">0xE0</span>, <span class="number">0x02</span>, <span class="number">0xF4</span>, <span class="number">0xB2</span>, <span class="number">0x2C</span>, <span class="number">0x5F</span>, <span class="number">0x22</span>, <span class="number">0x62</span>,</span><br><span class="line">        <span class="number">0x33</span>, <span class="number">0x0C</span>, <span class="number">0x01</span>, <span class="number">0x44</span>, <span class="number">0xBB</span>, <span class="number">0x70</span>, <span class="number">0x9D</span>, <span class="number">0x92</span>, <span class="number">0x8A</span>, <span class="number">0x06</span>, <span class="number">0xF9</span>, <span class="number">0x2C</span>, <span class="number">0x1D</span>, <span class="number">0x8F</span>, <span class="number">0x0A</span>, <span class="number">0xA9</span>,</span><br><span class="line">        <span class="number">0x22</span>, <span class="number">0x7B</span>, <span class="number">0x84</span>, <span class="number">0x30</span>, <span class="number">0x71</span>, <span class="number">0x13</span>, <span class="number">0xD0</span>, <span class="number">0xF9</span> &#125;;</span><br><span class="line"></span><br><span class="line">    decrypt(cipher, <span class="number">40</span>, (<span class="type">uint32_t</span>*)&amp;Key);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.40s\n&quot;</span>, cipher);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ebbc8827-c040-4a7d-8bc7-0aeccb1ce094</span></span><br></pre></td></tr></table></figure>
<p>从动态调试看，之前通过动态访问对密文和0x1c进行了异或</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202152459537.png" alt="image-20260202152459537" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202152542830.png" alt="image-20260202152542830" /></p>
<h2 id="bsod"><a class="markdownIt-Anchor" href="#bsod"></a> BSOD 😃</h2>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20260202170513575.png" alt="image-20260202170513575" /></p>
</div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/2098/12/31/develop_handbook/">prev_post</a><a class="pagination__link pagination__next" href="/2026/01/27/heavens-gate/">next_post</a></div></main><footer class="footer metadata"><p class="footer__text">© 2026 Joe1sn</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>